<div class="min-h-screen bg-bg flex flex-col">
  <header class="bg-primary text-white sticky top-0 z-20">
    <div class="px-6 py-4">
      <div class="flex items-center justify-between gap-4">
        <h1 class="text-xl font-semibold">Dynamic Form Generator</h1>
        @if (userFillMode()) {
        <span
          class="text-xs bg-white/10 text-white px-3 py-1 rounded-full border border-white/20"
        >
          User fill mode Â· {{ formsService.getCurrentFormName() }}
        </span>
        }
      </div>
    </div>
    <!-- Tabs Navigation -->
    @if (!userFillMode()) {
    <nav class="bg-card border-t border-border">
      <div class="px-6 flex gap-8">
        <button
          (click)="goToStep('forms')"
          class="py-4 px-2 border-b-2 font-medium transition-colors"
          [class.border-primary]="currentStep() === 'forms'"
          [class.text-primary]="currentStep() === 'forms'"
          [class.border-transparent]="currentStep() !== 'forms'"
          [class.text-muted]="currentStep() !== 'forms'"
        >
          Forms
        </button>
        <button
          (click)="goToStep('fields')"
          [disabled]="!hasActiveForm()"
          class="py-4 px-2 border-b-2 font-medium transition-colors"
          [class.border-primary]="currentStep() === 'fields'"
          [class.text-primary]="currentStep() === 'fields'"
          [class.border-transparent]="currentStep() !== 'fields'"
          [class.text-muted]="currentStep() !== 'fields' || !hasActiveForm()"
          [class.opacity-50]="!hasActiveForm()"
          [class.cursor-not-allowed]="!hasActiveForm()"
        >
          Builder
        </button>
        <button
          (click)="goToStep('rules')"
          [disabled]="!hasActiveForm()"
          class="py-4 px-2 border-b-2 font-medium transition-colors"
          [class.border-primary]="currentStep() === 'rules'"
          [class.text-primary]="currentStep() === 'rules'"
          [class.border-transparent]="currentStep() !== 'rules'"
          [class.text-muted]="currentStep() !== 'rules' || !hasActiveForm()"
          [class.opacity-50]="!hasActiveForm()"
          [class.cursor-not-allowed]="!hasActiveForm()"
        >
          Rules
        </button>
        <button
          (click)="goToStep('preview')"
          [disabled]="!hasActiveForm()"
          class="py-4 px-2 border-b-2 font-medium transition-colors"
          [class.border-primary]="currentStep() === 'preview'"
          [class.text-primary]="currentStep() === 'preview'"
          [class.border-transparent]="currentStep() !== 'preview'"
          [class.text-muted]="currentStep() !== 'preview' || !hasActiveForm()"
          [class.opacity-50]="!hasActiveForm()"
          [class.cursor-not-allowed]="!hasActiveForm()"
        >
          Preview
        </button>
      </div>
    </nav>
    }
  </header>

  <main class="p-6 pb-28 flex-1 overflow-auto">
    @if (currentStep() === 'forms') {
    <app-forms-step
      (nextStep)="onNextStep()"
      (backStep)="onBackStep()"
      (formSelected)="onFormSelected($event)"
      (startUserFill)="onUserFillStart($event)"
      (editSubmission)="onSubmissionEdit($event)"
    ></app-forms-step>
    } @else if (currentStep() === 'fields') {
    <app-fields-step
      [formName]="formsService.getCurrentFormName()"
      (nextStep)="onNextStep()"
      (backStep)="onBackStep()"
    ></app-fields-step>
    } @else if (currentStep() === 'rules') {
    <app-rules-step
      (nextStep)="onNextStep()"
      (backStep)="onBackStep()"
    ></app-rules-step>
    } @else if (currentStep() === 'preview') {
    <app-preview-step
      #previewCmp
      [initialValues]="initialValues()"
      (nextStep)="onPreviewSubmit($event)"
      (backStep)="onBackStep()"
    ></app-preview-step>
    }
  </main>

  <footer
    class="bg-white border-t border-border px-6 py-4 flex items-center justify-between fixed bottom-0 left-0 right-0 z-20"
  >
    @if (currentStep() !== 'forms') {
    <button
      type="button"
      (click)="handleBackClick()"
      class="px-6 py-2 border border-border text-text rounded-md hover:bg-bg font-medium disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Back
    </button>
    } @else {
    <span></span>
    } @if (submissionSaved()) {
    <span class="text-sm text-muted">Submission saved to your browser.</span>
    }
    <button
      type="button"
      (click)="handleNextClick()"
      class="px-6 py-2 bg-primary text-white rounded-md hover:opacity-90 font-medium disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="isPrimaryDisabled()"
    >
      {{ currentStep() === 'preview' ? 'Submit' : 'Next' }}
    </button>
  </footer>
</div>
