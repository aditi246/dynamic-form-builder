@if (tour.isActive()) {
<div class="fixed inset-0 z-50 pointer-events-none">
  @if (highlightRect(); as rect) {
  <div
    class="absolute bg-black/65"
    [ngStyle]="{ top: 0, left: 0, right: 0, height: px(rect.top) }"
    aria-hidden="true"
  ></div>
  <div
    class="absolute bg-black/65"
    [ngStyle]="{
      top: px(rect.bottom),
      left: 0,
      right: 0,
      bottom: 0
    }"
    aria-hidden="true"
  ></div>
  <div
    class="absolute bg-black/65"
    [ngStyle]="{
      top: px(rect.top),
      left: 0,
      width: px(rect.left),
      height: px(rect.height)
    }"
    aria-hidden="true"
  ></div>
  <div
    class="absolute bg-black/65"
    [ngStyle]="{
      top: px(rect.top),
      left: px(rect.right),
      right: 0,
      height: px(rect.height)
    }"
    aria-hidden="true"
  ></div>
  <div
    class="absolute border-2 border-primary/80 rounded-xl shadow-[0_0_0_8px_rgba(59,130,246,0.2)] transition-all duration-200 pointer-events-none"
    [ngStyle]="{
      top: px(rect.top),
      left: px(rect.left),
      width: px(rect.width),
      height: px(rect.height)
    }"
  ></div>
  } @else {
  <div
    class="absolute inset-0 bg-black/65"
    aria-hidden="true"
    style="pointer-events: none"
  ></div>
  }

  <div
    class="absolute max-w-sm pointer-events-auto bg-card text-text rounded-xl shadow-2xl border border-border/70"
    [ngStyle]="calloutStyle()"
  >
    <div class="p-4 space-y-3">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-1">
          <p class="text-2xs text-muted">
            Step {{ tour.stepNumber() }} of {{ tour.stepCount() }}
          </p>
          <h3 class="text-lg font-semibold text-text">
            {{ tour.currentStep()?.title }}
          </h3>
        </div>
        <button
          type="button"
          (click)="tour.skip()"
          class="text-xs text-muted hover:text-white bg-white/5 hover:bg-white/10 px-2 py-1 rounded-md border border-border"
        >
          Skip
        </button>
      </div>

      <p class="text-sm text-muted leading-relaxed">
        {{ tour.currentStep()?.description }}
      </p>

      <div class="flex items-center justify-between gap-3">
        <button
          type="button"
          (click)="tour.previous()"
          class="px-3 py-2 text-sm border border-border rounded-md hover:bg-bg text-text disabled:opacity-50"
          [disabled]="tour.stepNumber() <= 1"
        >
          Back
        </button>
        <div class="flex gap-2 items-center">
          <button
            type="button"
            (click)="tour.complete()"
            class="px-3 py-2 text-sm border border-border rounded-md hover:bg-bg text-text"
          >
            End
          </button>
          <button
            type="button"
            (click)="tour.next()"
            class="px-3 py-2 text-sm bg-primary text-white rounded-md hover:opacity-90"
          >
            {{ tour.stepNumber() === tour.stepCount() ? 'Finish' : 'Next' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
}
